# NAME

Log::Any

# SYNOPSIS

```perl6
use Log::Any::Adapter::File;
Log.add( Log::Any::Adapter::File.new( '/path/to/file.log' ) );

use Log::Any;
Log.info( 'yolo' );
Log.error( :category('security'), 'oups');
Log.log( :msg('msg from app'), :category( 'network' ), :severity( Log::Any::INFO ) );
```

# DESCRIPTION

Log::Any is a library to generate and handle application logs.
A log is a message indicating an application status in a moment in time. It has attributes, like a _severity_ (error, warning, debug, …), a _category_, a _date_ and a _message_.

These attributes are used by the "Formatter" to format the log and can also be used to filter logs and to choose where the log will be handled (via Adapters).

## SEVERITY

The severity is the level of urgence of a log.
It can take the following values:
- error
- warning
- info
- notice
- debug
- trace

## CATEGORY

The category allows to classify them.

_Default value_ : the package name where the log is generated.

## TAGS ?

Where?
	- in place of category ?
	- as extended intormations ? +1
How?
	- tags: [ tag1, tag2 ]
	- how to log them (array) ?

## DATE

The date is generated by Log::Any, and its values is the current date and time (ISO 8601).

## MESSAGE

TODO

# ADAPTERS

An adapter handles a log by storing it, or sending it elsewhere.

A few examples:

- Log::Any::Adapter::File
- Log::Any::Adapter::Database::SQL
- Log::Any::Adapter::STDOUT

TODO: What happens if no adapters are defined ?
- Shall we log into STDOUT ;
- Shall we throw an exceptions ;
- Shall we do nothing ++;

## FORMATTERS

Often, logs need to be formatted to simplify the storage (time-series databases), or the analysis (grep, log parser).
Formatters are just a string which defines the log format.

Formatters will use the attributes of a Log.

|Symbol|Signification|Description                                  |Default value             |
|------|-------------|---------------------------------------------|--------------------------|
|\\d   |Date (UTC)   |The date on which the log was generated      |Current date time         |
|\\c   |Category     |Can be any anything specified by the user    |The current package/module|
|\\s   |Severity     |Indicates if it's an information, or an error| none                     |
|\\m   |Message      |Payload, explains what is going on           | none                     |

```perl6
use Log::Any::Adapter::STDOUT( :format( '\d \c \m' ) );
```

You can of course use variables in the formatter, but since _\\_ is already used in Perl6 strings interpolation, you have to escape them.

```perl6
my $prefix = 'myapp ';
use Log::Any::Adapter::STDOUT( :path('/path/to/file.log', :format( "$prefix \\d \\c \\s \\m" ) );
```

# PIPELINES

A _pipeline_ is a set of Adapters and can be used to define alternatives path (a set of adapters, formatters and options). This allows to handle differently some logs (for example, for security or realtime).
If a log is produced with a specific facility which is not defined in the log consumers, the default facility is used.

Pipelines can be specified when an Adapter is added.
```perl6
Log::Any.add( 'my-pipeline', Log::Any::Adapter::Example.new );

Log::Any.error( :pipeline<security>, :msg('security error!', ... ) );
```

# EXTRA FEATURES

## Wrapping

### STDOUT, STDERR

Sometimes, applications or libraries are already available, and prints their logs to STDOUT and/or STDERR. Log::Any could captures these logs and manage them.

### EXCEPTIONS

Catches all unhandled exceptions to log them.

## Stacktrace

Dump a stacktrace with the log. This could be usefull to find a problem.
	Is it necessary?
	Is it possible to do in an Adapter or some Proxy ?

# APPENDICE

use Log::Any ( :async );

--async : enable asynchornous mode
	wait for adapter to write data to the file/network/whatever…

--log-on-error : keep in cache logs in streams (all, from trace to info)
	- if an error occurs (how to detect, using a level?), log the stacktrace ;
	- if nothing special occurs, log what as specified in the filters.

## Load log configuration from configuration files

- with a watcher on the file ?
	- pause dispatching during the reload ;
